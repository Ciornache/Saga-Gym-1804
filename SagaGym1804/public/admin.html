<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Admin Dashboard – SagaGym1804</title>
    <link rel="stylesheet" href="styles/admin.css">
  </head>

  <body>
    <div class="sidebar">
      <h2>Admin Menu</h2>
      <button onclick="afiseazaSectiune('utilizatori')">Utilizatori</button>
      <button onclick="afiseazaSectiune('exercitii')">Exerciții</button>
      <button onclick="afiseazaSectiune('antrenamente')">Antrenamente</button>
      <button onclick="afiseazaSectiune('grupe')">Grupe Musculare</button>
      <button onclick="afiseazaSectiune('corespondente')">Corespondențe</button>
      <button onclick="afiseazaSectiune('tip')">Tip</button>
      <button onclick="afiseazaSectiune('reviewuri')">Review-uri Exerciții</button>
      <!-- Contact Messages Button -->
      <button onclick="afiseazaSectiune('contact')" id="btn-contacts">
        Contact Messages
        <span id="badge-contacts" class="badge">0</span>
      </button>
    </div>

    <div class="main-content">
      <!-- Utilizatori Section -->
      <div id="sectiune-utilizatori" class="section active">
        <h2>👤 Utilizatori</h2>
        <button id="add-utilizator-btn" onclick="toggleFormular('utilizatori')">
          ➕ Adaugă Utilizator
        </button>
        <div id="form-utilizator" class="form-wrapper hidden">
          <h3 id="form-titlu">Adaugă Utilizator</h3>
          <input type="hidden" id="utilizatori-id">
          <label>Nume</label><input type="text" id="utilizatori-name">
          <label>Email</label><input type="email" id="utilizatori-email">
          <label>Parolă</label><input type="password" id="utilizatori-password">
          <label>Gen</label><input type="text" id="utilizatori-gender">
          <label>Interval vârstă</label><input type="text" id="utilizatori-interval_varsta">
          <label>Tip corp</label><input type="text" id="utilizatori-body_type">
          <label>Telefon</label><input type="text" id="utilizatori-phone_number">
          <label>Înălțime (cm)</label><input type="number" id="utilizatori-height">
          <label>Greutate (kg)</label><input type="number" id="utilizatori-weight">
          <label>Nivel fitness</label><input type="text" id="utilizatori-nivel_fitness">
          <button onclick="salveazaEntitate('utilizatori')">💾 Salvează</button>
          <button onclick="inchideFormular('utilizatori')">❌ Anulează</button>
        </div>
        <table id="tabel-utilizatori">
          <thead>
            <tr>
              <th>Nume</th><th>Email</th><th>Parolă</th><th>Gen</th>
              <th>Interval vârstă</th><th>Tip corp</th><th>Telefon</th>
              <th>Înălțime</th><th>Greutate</th><th>Nivel fitness</th>
              <th>Acțiuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Exerciții Section -->
      <div id="sectiune-exercitii" class="section">
        <h2>🏋️ Exerciții</h2>
        <button id="add-exercitii-btn" onclick="toggleFormular('exercitii')">
          ➕ Adaugă Exercițiu
        </button>
        <div id="form-exercitiu" class="form-wrapper hidden">
          <h3 id="form-exercitiu-titlu">Adaugă Exercițiu</h3>
          <input type="hidden" id="exercitii-id">
          <label>ID Exercițiu</label><input type="number" id="exercitii-id_exercitiu">
          <label>Nume</label><input type="text" id="exercitii-name">
          <label>Tip</label><input type="text" id="exercitii-type">
          <label>Imagine principală (URL)</label><input type="text" id="exercitii-cover_image">
          <label>Rating</label><input type="number" id="exercitii-rating">
          <label>Grupe musculare (virgulă)</label><input type="text" id="exercitii-muscle_groups">
          <label>Imagini (virgulă)</label><input type="text" id="exercitii-images">
          <button onclick="salveazaEntitate('exercitii')">💾 Salvează</button>
          <button onclick="inchideFormular('exercitii')">❌ Anulează</button>
        </div>
        <table id="tabel-exercitii">
          <thead>
            <tr>
              <th>ID</th><th>Nume</th><th>Tip</th><th>Imagine principală</th>
              <th>Rating</th><th>Grupe musculare</th><th>Imagini</th><th>Acțiuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="sectiune-antrenamente" class="section">
        <h2>📅 Antrenamente</h2>
        <button id="add-antrenamente-btn" onclick="toggleFormular('antrenamente')">
          ➕ Adaugă Antrenament
        </button>
        <div id="form-antrenament" class="form-wrapper hidden">
          <h3 id="form-antrenament-titlu">Adaugă Antrenament</h3>
          <input type="hidden" id="antrenamente-id">
          <label>ID Antrenament</label><input type="number" id="antrenamente-id_antrenament">
          <label>Nume</label><input type="text" id="antrenamente-name">
          <label>Tip</label><input type="text" id="antrenamente-type">
          <label>Email Utilizator</label><input type="email" id="antrenamente-user_email">
          <label>Data creării</label><input type="datetime-local" id="antrenamente-created_at">
          <button onclick="salveazaEntitate('antrenamente')">💾 Salvează</button>
          <button onclick="inchideFormular('antrenamente')">❌ Anulează</button>
        </div>
        <table id="tabel-antrenamente">
          <thead>
            <tr>
              <th>ID</th><th>Nume</th><th>Tip</th><th>Email utilizator</th>
              <th>Creat la</th><th>Acțiuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Grupe Musculare Section -->
      <div id="sectiune-grupe" class="section">
        <h2>💪 Grupe Musculare</h2>
        <button id="add-grupa-btn" onclick="toggleFormular('grupe')">
          ➕ Adaugă Grupă
        </button>
        <div id="form-grupa" class="form-wrapper hidden">
          <h3 id="form-grupa-titlu">Adaugă Grupă</h3>
          <input type="hidden" id="grupe-id">
          <label>Nume</label><input type="text" id="grupe-name">
          <label>Imagine (URL)</label><input type="text" id="grupe-image">
          <label>Descriere</label><input type="text" id="grupe-descriere">
          <button onclick="salveazaEntitate('grupe')">💾 Salvează</button>
          <button onclick="inchideFormular('grupe')">❌ Anulează</button>
        </div>
        <table id="tabel-grupe">
          <thead>
            <tr>
              <th>Nume</th><th>Imagine</th><th>Descriere</th><th>Acțiuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="sectiune-reviewuri" class="section">
  <h2>📝 Review-uri Exerciții</h2>
  <button id="add-reviewuri-btn" onclick="toggleFormular('reviewuri')">
    ➕ Adaugă Review
  </button>
  <div id="form-reviewuri" class="form-wrapper hidden">
    <h3 id="form-reviewuri-titlu">Adaugă Review</h3>
    <input type="hidden" id="reviewuri-id">
    <label>Nume Exercițiu</label><input type="text" id="reviewuri-exercise_name">
    <label>Email Utilizator</label><input type="email" id="reviewuri-user_email">
    <label>Rating</label><input type="number" min="1" max="5" id="reviewuri-rating">
    <label>Comentariu</label><input type="text" id="reviewuri-comentariu">
    <label>Dată</label><input type="datetime-local" id="reviewuri-data">
    <button onclick="salveazaEntitate('reviewuri')">📏 Salvează</button>
    <button onclick="inchideFormular('reviewuri')">❌ Anulează</button>
  </div>
  <table id="tabel-reviewuri">
    <thead>
      <tr>
        <th>Exercițiu</th>
        <th>Utilizator</th>
        <th>Rating</th>
        <th>Comentariu</th>
        <th>Dată</th>
        <th>Acțiuni</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
      <!-- Corespondențe Section -->
      <div id="sectiune-corespondente" class="section">
        <h2>🔗 Corespondență Exerciții – Antrenamente</h2>
        <button id="add-corespondenta-btn" onclick="toggleFormular('corespondente')">
          ➕ Adaugă Corespondență
        </button>
        <div id="form-corespondenta" class="form-wrapper hidden">
          <h3 id="form-corespondenta-titlu">Adaugă Corespondență</h3>
          <input type="hidden" id="corespondente-id">
          <label>ID Antrenament</label><input type="number" id="corespondente-id_antrenament">
          <label>ID Exercițiu</label><input type="number" id="corespondente-id_exercitiu">
          <label>Ordine</label><input type="number" id="corespondente-ordine">
          <label>Repetări</label><input type="number" id="corespondente-repetari">
          <label>Pauză (secunde)</label><input type="number" id="corespondente-pauza_secunde">
          <button onclick="salveazaEntitate('corespondente')">💾 Salvează</button>
          <button onclick="inchideFormular('corespondente')">❌ Anulează</button>
        </div>
        <table id="tabel-corespondente">
          <thead>
            <tr>
              <th>ID Antrenament</th><th>ID Exercițiu</th><th>Ordine</th>
              <th>Repetări</th><th>Pauză (sec)</th><th>Acțiuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Tip Section -->
      <div id="sectiune-tip" class="section">
        <h2>Tipuri</h2>
        <button id="add-tip-btn" onclick="toggleFormular('tip')">➕ Adaugă Tip</button>
        <table id="tabel-tip">
          <thead>
            <tr><th>Nume</th><th>Imagine</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="form-tip" class="form-wrapper hidden">
          <h3 id="form-tip-titlu">Adaugă Tip</h3>
          <input type="hidden" id="tip-id">
          <label>Nume</label><input type="text" id="tip-name">
          <label>Imagine</label><input type="text" id="tip-image">
          <button onclick="salveazaEntitate('tip')">💾 Salvează</button>
          <button onclick="inchideFormular('tip')">❌ Anulează</button>
        </div>
      </div>

      <!-- Contact Messages Section -->
      <div id="sectiune-contact" class="section">
        <h2>📬 Contact Messages</h2>
        <table id="contacts-table">
          <thead>
            <tr>
              <th>When</th><th>First Name</th><th>Last Name</th>
              <th>Email</th><th>Phone</th><th>Message</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script src="scripts/admin.js"></script>
    <script>
      // fetch badge + populate contact-messages section
      async function updateContactsSection() {
        try {
          const res = await fetch('/api/contacts');
          if (!res.ok) throw new Error(res.statusText);
          const msgs = await res.json();
          // badge
          const badge = document.getElementById('badge-contacts');
          badge.textContent = msgs.length;
          badge.style.display = msgs.length ? 'inline-block' : 'none';
          // table
          const tbody = document.querySelector('#contacts-table tbody');
          tbody.innerHTML = '';
          msgs.forEach(msg => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${new Date(msg.createdAt).toLocaleString()}</td>
              <td>${msg.firstName}</td>
              <td>${msg.lastName}</td>
              <td><a href="mailto:${msg.email}">${msg.email}</a></td>
              <td>${msg.phone || '–'}</td>
              <td>${msg.message.replace(/\n/g,'<br>')}</td>
            `;
            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error('Could not load contacts:', err);
        }
      }

      // initial load + poll
      updateContactsSection();
      setInterval(updateContactsSection, 30000);
    </script>
  </body>
</html>
