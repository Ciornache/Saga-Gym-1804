<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Admin Dashboard â€“ SagaGym1804</title>
    <link rel="stylesheet" href="styles/admin.css">
  </head>

  <body>
    <div class="sidebar">
      <h2>Admin Menu</h2>
      <button onclick="afiseazaSectiune('utilizatori')">Utilizatori</button>
      <button onclick="afiseazaSectiune('exercitii')">ExerciÈ›ii</button>
      <button onclick="afiseazaSectiune('antrenamente')">Antrenamente</button>
      <button onclick="afiseazaSectiune('grupe')">Grupe Musculare</button>
      <button onclick="afiseazaSectiune('corespondente')">CorespondenÈ›e</button>
      <button onclick="afiseazaSectiune('tip')">Tip</button>
      <button onclick="afiseazaSectiune('reviewuri')">Review-uri ExerciÈ›ii</button>
      <!-- Contact Messages Button -->
      <button onclick="afiseazaSectiune('contact')" id="btn-contacts">
        Contact Messages
        <span id="badge-contacts" class="badge">0</span>
      </button>
    </div>

    <div class="main-content">
      <!-- Utilizatori Section -->
      <div id="sectiune-utilizatori" class="section active">
        <h2>ğŸ‘¤ Utilizatori</h2>
        <button id="add-utilizator-btn" onclick="toggleFormular('utilizatori')">
          â• AdaugÄƒ Utilizator
        </button>
        <div id="form-utilizator" class="form-wrapper hidden">
          <h3 id="form-titlu">AdaugÄƒ Utilizator</h3>
          <input type="hidden" id="utilizatori-id">
          <label>Nume</label><input type="text" id="utilizatori-name">
          <label>Email</label><input type="email" id="utilizatori-email">
          <label>ParolÄƒ</label><input type="password" id="utilizatori-password">
          <label>Gen</label><input type="text" id="utilizatori-gender">
          <label>Interval vÃ¢rstÄƒ</label><input type="text" id="utilizatori-interval_varsta">
          <label>Tip corp</label><input type="text" id="utilizatori-body_type">
          <label>Telefon</label><input type="text" id="utilizatori-phone_number">
          <label>ÃnÄƒlÈ›ime (cm)</label><input type="number" id="utilizatori-height">
          <label>Greutate (kg)</label><input type="number" id="utilizatori-weight">
          <label>Nivel fitness</label><input type="text" id="utilizatori-nivel_fitness">
          <button onclick="salveazaEntitate('utilizatori')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('utilizatori')">âŒ AnuleazÄƒ</button>
        </div>
        <table id="tabel-utilizatori">
          <thead>
            <tr>
              <th>Nume</th><th>Email</th><th>ParolÄƒ</th><th>Gen</th>
              <th>Interval vÃ¢rstÄƒ</th><th>Tip corp</th><th>Telefon</th>
              <th>ÃnÄƒlÈ›ime</th><th>Greutate</th><th>Nivel fitness</th>
              <th>AcÈ›iuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- ExerciÈ›ii Section -->
      <div id="sectiune-exercitii" class="section">
        <h2>ğŸ‹ï¸ ExerciÈ›ii</h2>
        <button id="add-exercitii-btn" onclick="toggleFormular('exercitii')">
          â• AdaugÄƒ ExerciÈ›iu
        </button>
        <div id="form-exercitiu" class="form-wrapper hidden">
          <h3 id="form-exercitiu-titlu">AdaugÄƒ ExerciÈ›iu</h3>
          <input type="hidden" id="exercitii-id">
          <label>ID ExerciÈ›iu</label><input type="number" id="exercitii-id_exercitiu">
          <label>Nume</label><input type="text" id="exercitii-name">
          <label>Tip</label><input type="text" id="exercitii-type">
          <label>Imagine principalÄƒ (URL)</label><input type="text" id="exercitii-cover_image">
          <label>Rating</label><input type="number" id="exercitii-rating">
          <label>Grupe musculare (virgulÄƒ)</label><input type="text" id="exercitii-muscle_groups">
          <label>Imagini (virgulÄƒ)</label><input type="text" id="exercitii-images">
          <button onclick="salveazaEntitate('exercitii')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('exercitii')">âŒ AnuleazÄƒ</button>
        </div>
        <table id="tabel-exercitii">
          <thead>
            <tr>
              <th>ID</th><th>Nume</th><th>Tip</th><th>Imagine principalÄƒ</th>
              <th>Rating</th><th>Grupe musculare</th><th>Imagini</th><th>AcÈ›iuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="sectiune-antrenamente" class="section">
        <h2>ğŸ“… Antrenamente</h2>
        <button id="add-antrenamente-btn" onclick="toggleFormular('antrenamente')">
          â• AdaugÄƒ Antrenament
        </button>
        <div id="form-antrenament" class="form-wrapper hidden">
          <h3 id="form-antrenament-titlu">AdaugÄƒ Antrenament</h3>
          <input type="hidden" id="antrenamente-id">
          <label>ID Antrenament</label><input type="number" id="antrenamente-id_antrenament">
          <label>Nume</label><input type="text" id="antrenamente-name">
          <label>Tip</label><input type="text" id="antrenamente-type">
          <label>Email Utilizator</label><input type="email" id="antrenamente-user_email">
          <label>Data creÄƒrii</label><input type="datetime-local" id="antrenamente-created_at">
          <button onclick="salveazaEntitate('antrenamente')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('antrenamente')">âŒ AnuleazÄƒ</button>
        </div>
        <table id="tabel-antrenamente">
          <thead>
            <tr>
              <th>ID</th><th>Nume</th><th>Tip</th><th>Email utilizator</th>
              <th>Creat la</th><th>AcÈ›iuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Grupe Musculare Section -->
      <div id="sectiune-grupe" class="section">
        <h2>ğŸ’ª Grupe Musculare</h2>
        <button id="add-grupa-btn" onclick="toggleFormular('grupe')">
          â• AdaugÄƒ GrupÄƒ
        </button>
        <div id="form-grupa" class="form-wrapper hidden">
          <h3 id="form-grupa-titlu">AdaugÄƒ GrupÄƒ</h3>
          <input type="hidden" id="grupe-id">
          <label>Nume</label><input type="text" id="grupe-name">
          <label>Imagine (URL)</label><input type="text" id="grupe-image">
          <label>Descriere</label><input type="text" id="grupe-descriere">
          <button onclick="salveazaEntitate('grupe')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('grupe')">âŒ AnuleazÄƒ</button>
        </div>
        <table id="tabel-grupe">
          <thead>
            <tr>
              <th>Nume</th><th>Imagine</th><th>Descriere</th><th>AcÈ›iuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="sectiune-reviewuri" class="section">
  <h2>ğŸ“ Review-uri ExerciÈ›ii</h2>
  <button id="add-reviewuri-btn" onclick="toggleFormular('reviewuri')">
    â• AdaugÄƒ Review
  </button>
  <div id="form-reviewuri" class="form-wrapper hidden">
    <h3 id="form-reviewuri-titlu">AdaugÄƒ Review</h3>
    <input type="hidden" id="reviewuri-id">
    <label>Nume ExerciÈ›iu</label><input type="text" id="reviewuri-exercise_name">
    <label>Email Utilizator</label><input type="email" id="reviewuri-user_email">
    <label>Rating</label><input type="number" min="1" max="5" id="reviewuri-rating">
    <label>Comentariu</label><input type="text" id="reviewuri-comentariu">
    <label>DatÄƒ</label><input type="datetime-local" id="reviewuri-data">
    <button onclick="salveazaEntitate('reviewuri')">ğŸ“ SalveazÄƒ</button>
    <button onclick="inchideFormular('reviewuri')">âŒ AnuleazÄƒ</button>
  </div>
  <table id="tabel-reviewuri">
    <thead>
      <tr>
        <th>ExerciÈ›iu</th>
        <th>Utilizator</th>
        <th>Rating</th>
        <th>Comentariu</th>
        <th>DatÄƒ</th>
        <th>AcÈ›iuni</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
      <!-- CorespondenÈ›e Section -->
      <div id="sectiune-corespondente" class="section">
        <h2>ğŸ”— CorespondenÈ›Äƒ ExerciÈ›ii â€“ Antrenamente</h2>
        <button id="add-corespondenta-btn" onclick="toggleFormular('corespondente')">
          â• AdaugÄƒ CorespondenÈ›Äƒ
        </button>
        <div id="form-corespondenta" class="form-wrapper hidden">
          <h3 id="form-corespondenta-titlu">AdaugÄƒ CorespondenÈ›Äƒ</h3>
          <input type="hidden" id="corespondente-id">
          <label>ID Antrenament</label><input type="number" id="corespondente-id_antrenament">
          <label>ID ExerciÈ›iu</label><input type="number" id="corespondente-id_exercitiu">
          <label>Ordine</label><input type="number" id="corespondente-ordine">
          <label>RepetÄƒri</label><input type="number" id="corespondente-repetari">
          <label>PauzÄƒ (secunde)</label><input type="number" id="corespondente-pauza_secunde">
          <button onclick="salveazaEntitate('corespondente')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('corespondente')">âŒ AnuleazÄƒ</button>
        </div>
        <table id="tabel-corespondente">
          <thead>
            <tr>
              <th>ID Antrenament</th><th>ID ExerciÈ›iu</th><th>Ordine</th>
              <th>RepetÄƒri</th><th>PauzÄƒ (sec)</th><th>AcÈ›iuni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Tip Section -->
      <div id="sectiune-tip" class="section">
        <h2>Tipuri</h2>
        <button id="add-tip-btn" onclick="toggleFormular('tip')">â• AdaugÄƒ Tip</button>
        <table id="tabel-tip">
          <thead>
            <tr><th>Nume</th><th>Imagine</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="form-tip" class="form-wrapper hidden">
          <h3 id="form-tip-titlu">AdaugÄƒ Tip</h3>
          <input type="hidden" id="tip-id">
          <label>Nume</label><input type="text" id="tip-name">
          <label>Imagine</label><input type="text" id="tip-image">
          <button onclick="salveazaEntitate('tip')">ğŸ’¾ SalveazÄƒ</button>
          <button onclick="inchideFormular('tip')">âŒ AnuleazÄƒ</button>
        </div>
      </div>

      <!-- Contact Messages Section -->
      <div id="sectiune-contact" class="section">
        <h2>ğŸ“¬ Contact Messages</h2>
        <table id="contacts-table">
          <thead>
            <tr>
              <th>When</th><th>First Name</th><th>Last Name</th>
              <th>Email</th><th>Phone</th><th>Message</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script src="scripts/admin.js"></script>
    <script>
      // fetch badge + populate contact-messages section
      async function updateContactsSection() {
        try {
          const res = await fetch('/api/contacts');
          if (!res.ok) throw new Error(res.statusText);
          const msgs = await res.json();
          // badge
          const badge = document.getElementById('badge-contacts');
          badge.textContent = msgs.length;
          badge.style.display = msgs.length ? 'inline-block' : 'none';
          // table
          const tbody = document.querySelector('#contacts-table tbody');
          tbody.innerHTML = '';
          msgs.forEach(msg => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${new Date(msg.createdAt).toLocaleString()}</td>
              <td>${msg.firstName}</td>
              <td>${msg.lastName}</td>
              <td><a href="mailto:${msg.email}">${msg.email}</a></td>
              <td>${msg.phone || 'â€“'}</td>
              <td>${msg.message.replace(/\n/g,'<br>')}</td>
            `;
            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error('Could not load contacts:', err);
        }
      }

      // initial load + poll
      updateContactsSection();
      setInterval(updateContactsSection, 30000);
    </script>
  </body>
</html>
